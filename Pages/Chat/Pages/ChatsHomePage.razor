@page "/chats/"
@inject HttpClient Http
@inject CurrentUserAccessor CurrentUserAccessor

<PageTitle>Chats</PageTitle>

<ChatUserComponent User="@_chatUser"></ChatUserComponent> <br/>
<a href="chats/create">Создать новый чат</a><br/>
<ChatListComponent Chats="@_chats"></ChatListComponent>

@code {
    private ChatUserModel? _chatUser;
    private List<ChatModel> _chats = new();
    
    [Parameter]
    public int ChatId { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _chatUser = await CurrentUserAccessor.GetCurrentUserAsync();

            var chatsResponse = await Http.GetFromJsonAsync<GetAllChatsResult>("api/Chats");
            _chats = chatsResponse!.Chats.ToList();
        }
        catch (AccessTokenNotAvailableException exception)
        {
            exception.Redirect();
        }
        catch (Exception e)
        {
            Console.Error.WriteLine(e);
        }
    }

}